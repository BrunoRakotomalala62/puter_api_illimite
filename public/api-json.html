<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Response</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
      font-size: 14px;
      background: #fff;
      color: #000;
      padding: 10px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body><script src="https://js.puter.com/v2/"></script><script>
const urlParams = new URLSearchParams(window.location.search);
const prompt = urlParams.get('prompt') || 'Bonjour';
const image_url = urlParams.get('image_url') || '';
const uid = urlParams.get('uid') || '';
const model = urlParams.get('model') || (image_url ? 'gpt-5-nano' : 'gpt-4.1-nano');

(async function() {
  try {
    let response;
    
    if (image_url) {
      response = await puter.ai.chat(prompt, image_url, { model: model });
    } else {
      response = await puter.ai.chat(prompt, { model: model });
    }
    
    let responseText = '';
    if (typeof response === 'string') {
      responseText = response;
    } else if (response.message && response.message.content) {
      if (Array.isArray(response.message.content)) {
        responseText = response.message.content.map(c => c.text || c).join('\n');
      } else {
        responseText = response.message.content;
      }
    } else if (response.content) {
      if (Array.isArray(response.content)) {
        responseText = response.content.map(c => c.text || c).join('\n');
      } else {
        responseText = response.content;
      }
    } else {
      responseText = JSON.stringify(response);
    }
    
    const jsonData = {
      success: true,
      model: model,
      prompt: prompt,
      image_url: image_url || null,
      uid: uid || null,
      response: responseText,
      timestamp: new Date().toISOString()
    };
    document.body.textContent = JSON.stringify(jsonData, null, 2);
  } catch (error) {
    let errorMsg = 'Une erreur est survenue';
    if (error && error.message) {
      errorMsg = error.message;
    } else if (error && typeof error === 'string') {
      errorMsg = error;
    } else if (error && error.error) {
      if (typeof error.error === 'string') {
        errorMsg = error.error;
      } else if (error.error.message) {
        errorMsg = error.error.message;
      } else {
        errorMsg = JSON.stringify(error.error);
      }
    } else if (error) {
      errorMsg = JSON.stringify(error);
    }
    const jsonData = {
      success: false,
      model: model,
      prompt: prompt,
      image_url: image_url || null,
      uid: uid || null,
      error: errorMsg,
      timestamp: new Date().toISOString()
    };
    document.body.textContent = JSON.stringify(jsonData, null, 2);
  }
})();
</script></body>
</html>
